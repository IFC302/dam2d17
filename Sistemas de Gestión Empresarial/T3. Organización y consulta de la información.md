# T3. Organización y consulta de la información

## 3.1- Introducción
La base de datos de un sistema ERP es de gran envergadura, almacena las tablas con todos los datos de la aplicación, con las vistas de las diferentes tablas y otros elementos como funciones o disparadores que realizan operaciones sobre los datos. Por ello, debido de esta gran cantidad de información almacenada es necesario la organización de todos sus componentes.
Lo que se hace es establecer una serie de normativas o nomenclaturas para organizar la información, que los desarrolladores deberán seguir a la hora de modificar el código fuente o el esquema de la base de datos. por ejemplo, incluir un prefijo en los componentes de la base de datos para saber a que módulo pertenece, o establecer una serie de campos dentro de una tabla como obligatorios para poder asegurar el funcionamiento de la aplicación. En los sistemas de planificación empresarial desarrollados en un lenguaje orientado a objetos cualquier datos es accesible a través de los objetos.
Cualquier método que quiera activar sobre un objeto deberá de tener un parámetro que indique sobre que recurso o registro dentro de dicho objeto se quiere actuar, por ejemplo, si queremos enviar un correo electrónico en todos los colaboradores indicados en el rango del 1 al 5 según su id que sabemos que están dentro de la tabla `res_partner` utilizaremos una instrucción como la siguiente.
Podemos decir, en resumen, que un objeto es un concepto amplio que engloba a todo elemento que forma parte de la aplicación y que permite además acceder a los datos de esta.


### 3.1.1- Seleccionado de tablas y vistas de la base de datos
Como ya sabemos, un objeto va  a guardar todo elemento que forma parte de la aplicación. Como elementos de la aplicación tendremos la propia base de datos con sus tablas, disparadores y acciones sobre dichas tablas ademas de sus informes y ventanas. Vamos a entender como una tabla una estructura de datos organizada en filas y columnas, de manera que cada columna es un campo y cada fila un registro.
En ocasiones la base de datos está formada por tantas tablas y objetos que se vuelve difícil de manejar. En estos casos interesa que algunos grupos o perfiles de usuarios tengan una vista parcial de esos datos. En estos casos utilizamos las vistas, donde una vista es una tabla virtual a donde podremos acceder como si se tratase de una tabla de esquema, pero que realmente no lo es. Tiene la misma estructura que las tablas (filas y columnas) y podremos acceder a ellas a través de la misma forma.
Para administrar la base de datos nos conectaremos directamente al gestor de base de datos a través de una herramienta como por ejemplo pgAdmin. Para realizar la conexión en pgAdmin necesitaremos los campos:
* Nombre: Nombre de la conexión
* Servidor: Dirección de nombre de servidor (`localhost`)
* Puerto: Número de puerto de conexión (`5432`)
* Base de datos de mantenimiento: Normalmente `postgres`
* Nombre de usuario: Usuario de conexión al entorno (`openpg`)
* Contraseña (`admin`)

### 3.1.2- Consultas de acceso a datos
Las consultas de acceso a datos nos van a permitir acceder a la información que se guarda en las tablas y las vistas. Las consultas de acceso a datos sirven para indicar al sistema de gestión de la base de datos que devuelva una serie de información en un conjunto de registros. los pasos que utilizaremos para crear una consulta serán:
1. Seleccionar las tablas o vistas sobre las que va a actuar la consulta.
2. Establecer la relación entre las tablas y vistas.
3. Seleccionar los campos que queramos mostrar en la consulta.
4. Ejecutar dicha consulta.

---

Las consultas de acceso a datos se pueden construir escribiendo el código en lenguaje SQL, aunque también podríamos utilizar asistentes y constructores gráficos si las consultas no son muy complejas

## 3.2- Visualización de la información

Dado que todos los datos del programa están almacenados en objetos, tanto la información de las tablas como las de cualquier otro objeto de la aplicación se van a mostrar a través de interfaces.
Cada objeto va a tener su propio interfaz, por ejemplo no se va a mostrar de la misma manera los datos de una empresa que los datos de una factura. Las interfaces van a poder ser:
* Interfaces estáticas: Se crean dentro del código de la aplicación y no pueden ser modificadas.
* Interfaces dinámicas: No pueden ser modificadas por parte del usuario, por lo cual se almacenados la descripción de la vista en un lenguaje de descripción de datos que permita su modificación, como es el XML. Por tanto, las interfaces dinámicas son construidas de forma dinámica a través de su descripción XML de forma que genere la pantalla del cliente. Así se pueden hacer objetos sencillos simplemente tomando como ejemplos otros objetos que ya hayan sido creados por la aplicación.

El siguiente código es un ejemplo de construcción de un objeto en Odoo:
```xml
<?xml version="1.0" encoding="utf-8"?>
<form string="partner">
	<field name="name"/>
	<field name="title"/>
	<field name="ref"/>
	<field name="lang"/>
	<field name="customer"/>
	<field name="supplier"/>
</form>
```
En el código anterior se esta definiendo una interfaz, en esta se va a poder introducir y consultar datos. Y mas concretamente se muestran 6 campos correspondiente al nombre, al titulo, a la referencia, al lenguaje, y dos boolean que guardan si se trata de un cliente o de un proveedor. Esta definición se almacenara a través de un fichero xml que al abrirlo desde la aplicación mostraría el objeto resultante. Ruta de vistas XML en Odoo:

`C:\Program Files (x86)\Odoo 13.0\server\odoo\addons\sale\views`

```
PASOS

1. Ajustes
2. Activar Modo Desarollador
3. Formulario (Un producto por ejemplo)
4. Botón debug: EDITAR VISTA / FORMULARIO
```

- Nombre de la VISTA: Determina la vista modificada
- Tipo de VISTA: Determina como se muestra la información
  
Ejemplo: `product.template.product.form`

Vista heredada: 

`product.template.common.form -> product.template.product.form`

```sql
PASOS

1. En db01:
select name, model, type, arch_db from ir_ui_view;
```

```
RUTA DE DIRECTORIOS

project
│   README.md
│   file001.txt    
│
└───folder1
│   │   file011.txt
│   │   file012.txt
│   │
│   └───subfolder1
│       │   file111.txt
│       │   file112.txt
│       │   ...
│   
└───folder2
    │   file021.txt
    │   file022.txt
```

---

### 3.2.1- Interfaces de entrada de Datos y procesos
Podemos definir una o varias interfaces para cada objeto o tipo de recurso, para describir que campos se muestran y como se van a mostrar. Dependiendo de como se distribuyan los campos nos podemos encontrar los siguientes tipos de interfaces:
* Formularios: Se muestra un solo registro cuyos campos se distribuyen en la pantalla siguiendo siempre el mismo criterio. Normalmente la información se mostrará de izquierda a derecha y de arriba a abajo, de acuerdo con el orden en el que son descritos en la vista.
* Árboles: Este tipo de interfaces se va a utilizar cuando queramos mostrar un conjunto de registros en modo lista, y será útil para mostrar varios registros a la vez y realizar búsquedas sobre ellos.
* Gráficos (KANBAN): Los gráficos son otra forma de ver los datos de un formulario, pueden mostrarse de varias formas para una mejor visualización de la información.